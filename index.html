
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Carrito de Pedidos - Manufharm</title>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
    <script>
        (function(){
            emailjs.init("YOUR_PUBLIC_KEY_HERE"); // ← luego reemplazar por la Public Key real
        })();
    </script>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        #carrito { margin-top: 30px; }
        .btn { padding: 6px 12px; background-color: #007BFF; color: white; border: none; cursor: pointer; }
        .btn:hover { background-color: #0056b3; }
    </style>
</head>
<body>

<h1>Carrito de Pedidos - Manufharm</h1>

<div id="productos"></div>

<div id="carrito">
    <h3>Carrito</h3>
    <ul id="listaCarrito"></ul>
    <p><strong>Total: $<span id="total"></span></strong></p>
    <input type="text" id="cliente" placeholder="Nombre del cliente" />
    <button class="btn" onclick="enviarPedido()">Enviar Pedido</button>
</div>

<script>
let productos = [
    {"ean": "7800007142658", "interno": "10G012920N02", "descripcion": "PARACETAMOL 125MG INFX6 SUP", "precio": 490, "vencimiento": "46233"},
    {"ean": "7800007124326", "interno": "100516N02", "descripcion": "PARACETAMOL 500MGX16 COMP BE.(LAB CHILE)", "precio": 195, "vencimiento": "46660"}
];

let carrito = [];

function cargarProductos() {
    let html = '<table><tr><th>EAN</th><th>Interno</th><th>Descripción</th><th>Precio</th><th>Vencimiento</th><th>Cant</th><th>Agregar</th></tr>';
    productos.forEach((prod, index) => {
        html += `<tr>
                    <td>${prod.ean}</td>
                    <td>${prod.interno}</td>
                    <td>${prod.descripcion}</td>
                    <td>$${prod.precio}</td>
                    <td>${prod.vencimiento}</td>
                    <td><input type="number" id="cant_${index}" value="1" min="1" style="width:50px" /></td>
                    <td><button class="btn" onclick="agregar(${index})">Agregar</button></td>
                </tr>`;
    });
    html += '</table>';
    document.getElementById('productos').innerHTML = html;
}

function agregar(index) {
    const cantidad = parseInt(document.getElementById(`cant_${index}`).value);
    if (cantidad > 0) {
        const prod = productos[index];
        carrito.push({ ...prod, cantidad });
        actualizarCarrito();
    }
}

function actualizarCarrito() {
    const lista = document.getElementById("listaCarrito");
    lista.innerHTML = "";
    let total = 0;
    carrito.forEach(p => {
        total += p.precio * p.cantidad;
        const li = document.createElement("li");
        li.textContent = `${p.descripcion} x${p.cantidad} - $${p.precio * p.cantidad}`;
        lista.appendChild(li);
    });
    document.getElementById("total").textContent = total;
}

function enviarPedido() {
    const cliente = document.getElementById("cliente").value;
    if (!cliente || carrito.length === 0) {
        alert("Por favor, completa el nombre del cliente y agrega productos.");
        return;
    }

    const detalles = carrito.map(p => `${p.descripcion} x${p.cantidad} = $${p.precio * p.cantidad}`).join("\n");
    const total = carrito.reduce((sum, p) => sum + (p.precio * p.cantidad), 0);

    const templateParams = {
        cliente: cliente,
        message: detalles,
        total: total
    };

    emailjs.send("service_q06m7o8", "template_z5a44ua", templateParams)
        .then(response => {
            alert("Pedido enviado con éxito.");
            carrito = [];
            actualizarCarrito();
        }, error => {
            alert("Error al enviar: " + JSON.stringify(error));
        });
}

window.onload = cargarProductos;
</script>

</body>
</html>
